---
title: "ã€GCPã€‘Workflowsã‚’è§¦ã£ã¦ã¿ãŸ"
emoji: "ğŸ›©"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [GCP,Workflows]
published: true
---

## ã¯ã˜ã‚ã«

GCPã®Workflowsã‚’è§¦ã£ã¦ã¿ãŸã®ã§å‚™å¿˜éŒ²ã§ã™ã€‚

ã“ã®è¨˜äº‹ã«æ›¸ã„ã¦ã„ã‚‹ã“ã¨ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚

- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å‹•ã‹ã—ã‹ãŸ
- ãƒ¡ã‚¤ãƒ³ã¨ãªã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æ–‡ã‚’ç¢ºèª
- cloudfunctionsã¨ç¹‹ã„ã§ç¢ºèª

## GCP Workflowsã¨ã¯

GCPã®Workflowsã¯APIå‘¼ã³å‡ºã—ã‚„Cloud Functions, Cloud Runãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
AWSã®Step Functionsã¨ä¼¼ãŸã‚ˆã†ãªã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚(è§¦ã£ã¦ã¿ã¦ã¯Step Functionsã®ã»ã†ãŒã§ãã‚‹ã“ã¨ãŒå¤šã„ã¨æ€ã„ã¾ã—ãŸã€‚)

ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã§è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ã¨ãã€è¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ã«è·¨ã£ã¦å‡¦ç†ã‚’è¡Œã†ã“ã¨ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚
ãã®å ´åˆã¯ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ç­‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ä½¿ç”¨ã™ã‚‹ã®ãƒªã‚½ãƒ¼ã‚¹ãŒå¤šããªã‚Œã°ãªã‚‹ã»ã©å…¨ä½“ã®ãƒ•ãƒ­ãƒ¼ã‚’æŠŠæ¡ã™ã‚‹ã“ã¨ã¯å¤§å¤‰ã«ãªã‚Šã¾ã™ã€‚

ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ã«CloudFunctionsã‹ã‚‰pubsubã‚’çµŒç”±ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ãªã„ã¨å®Ÿè£…ã‹ã‚‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æŠŠæ¡ã™ã‚‹ã“ã¨ãŒå¤§å¤‰ã§ã™ã€‚
ã¾ãŸã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®éƒ½åˆã§CloudFunctionsã§ã¯æœ¬æ¥ã®å‡¦ç†ã«é–¢ä¿‚ãªã„ã€pubsubã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆã‚‚ã™ã‚‹å¿…è¦ãŒç™ºç”Ÿã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/6gk535ypkpw724s8if6sp0j7x7gd)

ã“ã†ã„ã£ãŸæ™‚ã«Workflowsã‚’ä½¿ç”¨ã™ã‚‹ã¨å‡¦ç†ã®é·ç§»ãŒæŠŠæ¡ã§ãã¦ã€å„å‡¦ç†ã¯ãƒ¡ã‚¤ãƒ³ã®å‡¦ç†ã®ã¿ã«é›†ä¸­ã§ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/e66t8c3b29hobhoc809c30nnovel)

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è©¦ã™

ã¾ãšã¯GCPã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œã£ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

GCPã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠã—ã€ä½œæˆã‚’ã‚¯ãƒªãƒƒã‚¯
![](https://storage.googleapis.com/zenn-user-upload/wwz1zdc93toylq8b17nje4dndqcf)

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãªã©ã‚’å…¥åŠ›ã€‚2021/3/19æ™‚ç‚¹ã§ã¯3ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰ã®é¸æŠã§ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/pgo5zl1tfe35nrxz42ztjdgtbdt0)

ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒä½œã‚‰ã‚Œã‚‹ã®ã§ã€ãã®ã¾ã¾ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/x8nxebw4xx864obuzk0f2bf1euxr)

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹
![](https://storage.googleapis.com/zenn-user-upload/rz65hpensjw84dap1gowqvwatv92)

å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/aq8nn0x8bsny3ql3ldbefrag5nif)

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®šç¾©ã‚’è¡Œã†ã¨UIã§å®Ÿè¡Œé †ãŒç¢ºèªã§ãã‚‹ã®ã§å‡¦ç†ã®æµã‚ŒãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä½œæˆ

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯YAMLã‚‚ã—ãã¯JSONã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æ–‡ã§ä½œæˆã—ã¾ã™ã€‚
å®Ÿè¡Œæ™‚ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ãŸã‚Šã€æ¡ä»¶åˆ†å²ã€ãƒ«ãƒ¼ãƒ—ãªã©ã‚‚è¡Œã†ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

### Steps

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã¯æœ€ä½ï¼‘ã¤ã®StepãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚
ãã—ã¦ã€stepã«ã¯ä¸‹è¨˜ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

- HTTPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‘¼ã³å‡ºã—
- å¤‰æ•°ã®å‰²ã‚Šå½“ã¦
- ã‚¹ãƒªãƒ¼ãƒ—
- æ¡ä»¶ä»˜ãåˆ†å²
- å€¤ã‚’è¿”ã™

#### HTTPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‘¼ã³å‡ºã—

HTTPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ä¸‹è¨˜ã®ã‚ˆã†ã«å®šç¾©ã§ãã¾ã™ã€‚
[å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://cloud.google.com/workflows/docs/reference/syntax?hl=ja#invoking_an_http_endpoint)

```yaml
- STEP_NAME:
  # å¿…é ˆé …ç›®ã§http.getã€http.postã€http.requestã‹ã‚‰é¸æŠã™ã‚‹
  call: {http.get|http.post|http.request}
  args:
    # å¿…é ˆé …ç›®ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã™ã‚‹URLã‚’è¨˜è¼‰ã™ã‚‹
    url: URL_VALUE
    # callã‚’http.requestã«ã—ãŸå ´åˆã€å¿…é ˆé …ç›®ã¨ãªã‚‹ã€‚GET,POST,PATCH,DELETEã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¨˜è¼‰
    method: REQUEST_METHOD
    # httpãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ã‚’è¨˜è¼‰
    headers:
        KEY:VALUE
    # httpãƒªã‚¯ã‚¨ã‚¹ãƒˆã®bodyã‚’è¨˜è¼‰
    body:
        KEY:VALUE
    # httpãƒªã‚¯ã‚¨ã‚¹ãƒˆã®queryã‚’è¨˜è¼‰
    query:
        KEY:VALUE
    # APIã«èªè¨¼ãŒå¿…è¦ãªå ´åˆã«ä½¿ç”¨ã™ã‚‹
    auth:
        type:{OIDC|OAuth2}
    # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ç§’æ•°ã‚’æŒ‡å®šã§ãã‚‹
    timeout: VALUE_IN_SECONDS
  # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®çµæœã‚’æ ¼ç´ã™ã‚‹
  result: RESPONSE_VALUE
```

ä¾‹ãˆã°ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã™ã‚‹ã¨
```yaml
- æ—¥ä»˜ã‚’å–å¾—:
  call: http.get
  args:
    # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚µãƒ³ãƒ—ãƒ«APIãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹
    url: https://us-central1-workflowsample.cloudfunctions.net/datetime
  result: currentTime
- çµæœç¢ºèª:
  return: ${currentTime}
```

UIã§ã¯ã“ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/muzxl70b972z4ydf7cgmy7dkiwyf)

å®Ÿè¡Œçµæœã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚
```json
{
  "body": {
    "dayOfTheWeek": "Thursday"
  },
  "code": 200,
  "headers": {
    "Alt-Svc": "h3-29=\":443\"; ma=2592000,h3-T051=\":443\"; ma=2592000,h3-Q050=\":443\"; ma=2592000,h3-Q046=\":443\"; ma=2592000,h3-Q043=\":443\"; ma=2592000,quic=\":443\"; ma=2592000; v=\"46,43\"",
    "Cache-Control": "private",
    "Content-Length": "28",
    "Content-Type": "application/json",
    "Date": "Thu, 18 Mar 2021 15:45:28 GMT",
    "Function-Execution-Id": "65g9tfc9ngh5",
    "Server": "Google Frontend",
    "X-Cloud-Trace-Context": "e632a6e77f1d1dc1c827d597a7b02fe8;o=1"
  }
}
```

#### å¤‰æ•°ã®å‰²ã‚Šå½“ã¦

å¤‰æ•°ã®åˆæœŸåŒ–ã€æ›´æ–°ãŒã§ãã¾ã™ã€‚å¤‰æ•°ã¯åˆ¥ã®stepã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```yaml
- STEP_NAME:
  assign:
    - VARIABLE_NAME: VALUE
```

ä¸‹è¨˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€6ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```yaml
- å¤‰æ•°åˆæœŸåŒ–:
  assign:
    - number: 5
    - number_plus_one: ${number+1}
    - other_number: 10
    - string: "hello"
- çµæœç¢ºèª:
   return: ${number_plus_one}
```

#### ã‚¹ãƒªãƒ¼ãƒ—

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
APIã®åæ˜ å¾…ã¡ã‚„ãƒãƒƒãƒã§ä¸€æ™‚åœæ­¢ã™ã‚‹ã¨ããªã©ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

```yaml
- STEP_NAME:
  call: sys.sleep
  args:
    # ã‚¹ãƒªãƒ¼ãƒ—ã™ã‚‹ç§’æ•°
    seconds: SLEEP_IN_SECONDS
```

ä¸‹è¨˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨

```yaml
- å¤‰æ•°åˆæœŸåŒ–:
    assign:
        - number: 5
        - number_plus_one: ${number+1}
        - other_number: 10
        - string: "hello"
- ã‚¹ãƒªãƒ¼ãƒ—:
    call: sys.sleep
    args:
        seconds: 10
- çµæœç¢ºèª:
   return: ${number_plus_one}
```

å®Ÿè¡Œæ™‚é–“ãŒ10ç§’ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/j7qk51bc9f3s26pm6cdvsv0vbx34)

#### åˆ†å²

switchæ§‹æ–‡ã§æ¡ä»¶åˆ†å²ã‚’è¡¨ç¾ã§ãã¾ã™ã€‚

```yaml
- STEP_NAME_A:
    # æœ€å¤§10å€‹ã®conditionã‚’è¿½åŠ ã§ãã‚‹
    switch:
        - condition: ${EXPRESSION_A}
          # nextã®stepã«ç§»è¡Œã™ã‚‹
          next: STEP_NAME_B
        - condition: ${EXPRESSION_B}
          next: STEP_NAME_C
    # ã©ã®æ¡ä»¶ã«ã‚‚å¼•ã£ã‹ã‹ã‚‰ãªã„å ´åˆ
    next: STEP_NAME_D
```

ä¸‹è¨˜ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã™ã‚‹ã¨

```yaml
- æ—¥ä»˜å–å¾—:
    call: http.get
    args:
      url: https://us-central1-workflowsample.cloudfunctions.net/datetime
    result: currentTime
- æ›œæ—¥ãƒã‚§ãƒƒã‚¯:
    switch:
      - condition: ${currentTime.body.dayOfTheWeek == "Friday"}
        next: é‡‘æ›œæ—¥
      - condition: ${currentTime.body.dayOfTheWeek == "Saturday" OR currentTime.body.dayOfTheWeek == "Sunday"}
        next: é€±æœ«
    next: ä»•äº‹ã®æ›œæ—¥
- é‡‘æ›œæ—¥:
    return: "é‡‘æ›œæ—¥!"
- é€±æœ«:
    return: "é€±æœ«ï¼ï¼"
- ä»•äº‹ã®æ›œæ—¥:
    return: "ä»•äº‹ã®æ›œæ—¥"
```

ã“ã†ã„ã£ãŸè¡¨ç¤ºã«ãªã‚Šã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/bj79vlw56g339tf2yxeg3jnucwbb)

#### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®çµ‚äº†

ä¾‹å¤–ãŒæŠ•ã’ã‚‰ã‚ŒãŸæ™‚ã‚‚ã—ãã¯ã€`end`ã€`return`ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã¨ãã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯çµ‚äº†ã—ã¾ã™ã€‚

```yaml
- STEP_NAME:
    ...
    next: end
```

```yaml
- STEP_NAME:
    ...
    return: ${VARIABLE}
```

#### ãƒ«ãƒ¼ãƒ—ã®è¡¨ç¾

ãƒ«ãƒ¼ãƒ—ã¯nextã§å‰ã®stepã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§å¯èƒ½ã§ã™ã€‚

ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã™ã‚‹ã¨
```yaml
- define:
    assign:
      - array: ["foo", "ba", "r"]
      - result: ""
      - i: 0
- check_condition:
    switch:
      - condition: ${len(array) > i}
        next: iterate
    next: exit_loop
- iterate:
    assign:
      - result: ${result + array[i]}
      - i: ${i+1}
    next: check_condition
- exit_loop:
    return:
        concat_result: ${result}
```

ã“ã†ã„ã£ãŸè¡¨ç¤ºã«ãªã‚Šã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/nso1b16ner8dzc5frbkaxr4zb8lv)


#### å®Ÿè¡Œæ™‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å—ã‘å–ã‚Š

å®Ÿè¡Œæ™‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```yaml
main:
  # å—ã‘å–ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å®šç¾©
  params: [args]
  steps:
  - step1:
      assign:
        - outputVar: ${"Hello " + args.firstName + " " + args.lastName}
  - step2:
      return: ${outputVar}
```

å®Ÿè¡Œæ™‚ã«ä¸‹è¨˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã™ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
`{"firstName":"Sherlock","lastName":"Holmes"}`


#### ãƒ­ã‚°ã®å‡ºåŠ›

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã®ãƒ­ã‚°ã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œãªã„ãŸã‚ã€æ˜ç¤ºçš„ã«ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
`sys.log`ã‚’ä½¿ã†ã“ã¨ã§å‡ºåŠ›ãŒã§ãã¾ã™ã€‚

```yaml
- log:
    call: sys.log
    args:
      text: "ãƒ­ã‚°å‡ºåŠ›"
      severity: "INFO"
```

https://cloud.google.com/workflows/docs/log-workflow?hl=ja

## cloudfunctionã¨ã®é€£æº

cloudfunctionã¨ã®ç–é€šã‚’ç¢ºèªã—ã¾ã™ã€‚(ã¨ã‚Šã‚ãˆãšç¹‹ã’ã¦å‹•ã‹ã™ã ã‘ã§ã™)

cloudfunctionã®é–¢æ•°

```js:index.js
exports.helloWorld = (req, res) => {
  res.status(200).send({
    status: req.body.status,
    count: req.body.count + 1
  });
};
```

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
```yaml
- å¤‰æ•°åˆæœŸåŒ–:
    assign:
      - status: "start"
      - count: 0
- ãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ:
    call: http.post
    args:
      url: https://asia-northeast1-${PROJECT_NAME}.cloudfunctions.net/workflow-sample
      auth:
        # ã“ã‚Œã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§èªè¨¼ãŒå¯èƒ½ã«ãªã‚‹
        type: OIDC
      body:
        status: ${status}
        count: ${count}
    result: returnValue
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª:
    switch:
      - condition: ${returnValue.body.status == "start"}
        next: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’updateã«æ›´æ–°
      - condition: ${returnValue.body.status == "create"}
        next: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’createã«æ›´æ–°
    next: çµ‚äº†
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’updateã«æ›´æ–°:
    assign:
      - status: "update"
      - count: ${returnValue.body.count}
    next: ã‚¹ãƒªãƒ¼ãƒ—
- ã‚¹ãƒªãƒ¼ãƒ—:
    call: sys.sleep
    args:
      # ã‚¹ãƒªãƒ¼ãƒ—ã™ã‚‹ç§’æ•°
      seconds: 10
    next: ãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’createã«æ›´æ–°:
    assign:
      - status: "create"
      - count: ${returnValue.body.count}
    next: ãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- çµ‚äº†:
    return: ${returnValue}
```

å®Ÿè¡Œã™ã‚‹ã¨å…¨ã¦ã®åˆ†å²ã‚’é€šã£ã¦å®Œäº†ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/rlrtz5vbjfcbxzpnkaeziueq1k5r)


## ãŠã‚ã‚Šã«

ã“ã®ä»–ã«ã‚‚ä¾‹å¤–å‡¦ç†ã‚„ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ã‚‚ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§å®šç¾©å¯èƒ½ã®ãŸã‚ã€æ¥­å‹™ã§ã‚‚ä½¿ãˆã‚‹å°è±¡ã§ã™ã€‚
ã—ã‹ã—ã€ç¾åœ¨å®Ÿè¡Œä¸­ã®ã‚¿ã‚¹ã‚¯ã‚’UIã§ç¢ºèªã§ããªã„ã€‚ä¸¦åˆ—ã§ã‚¿ã‚¹ã‚¯ã‚’å‡¦ç†ã§ããªã„ãªã©ã‚‚ã‚ã‚ŠStep Functionsã‚’æ¯”ã¹ã‚‹ã¨æ©Ÿèƒ½çš„ã«åŠ£ã£ã¦ã„ã‚‹å°è±¡ã§ã™ã€‚ä»Šå¾Œã®æ©Ÿèƒ½è¿½åŠ ã«æœŸå¾…ã—ãŸã„ã§ã™ï¼ï¼

ã¾ãŸã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è©³ç´°ã®å®Ÿè¡Œæ•°ã«ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã‹ã£ãŸã®ã§ã™ãŒã€ã‚ˆãåˆ†ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ...

![](https://storage.googleapis.com/zenn-user-upload/6qh1u7dhwdwtbq27m76pptl2njan)

## å‚è€ƒè³‡æ–™

- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚µãƒ³ãƒ—ãƒ«ãŒãŸãã•ã‚“ã‚ã‚Šã¾ã™ã€‚
https://cloud.google.com/workflows/docs/sample-workflows?hl=ja
- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ§‹æ–‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã§ã™
https://cloud.google.com/workflows/docs/reference/syntax?hl=ja
- GCP Workflowsè©¦ã—ã¦ã¿ãŸ
https://zenn.dev/ogataka50/articles/fde9633be02080