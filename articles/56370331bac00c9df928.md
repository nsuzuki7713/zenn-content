---
title: "gsutil -mã§ problems with multiprocessing on MacOSãŒç™ºç”Ÿã—ãŸæ™‚ã®è§£æ±ºæ–¹æ³•"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GCP", "gsutil"]
published: true
---

## å•é¡Œ

Cloud Storageã¯Consoleã‹ã‚‰ã ã¨1ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã—ã‹ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ããªã„ãŸã‚ã€
ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯ã€gsutil ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/6icvrym7xvryu3n9p4x2groatgkq)

ã‚³ãƒãƒ³ãƒ‰ãŒè¨˜è¼‰ãŒã‚ã£ãŸã®ã§ã€ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ä¸‹è¨˜ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

```bash
$ gsutil -m cp -r "gs://firebase-tutorial-suzuki.appspot.com/buckup-test/" .
If you experience problems with multiprocessing on MacOS, they might be related to https://bugs.python.org/issue33725. 
You can disable multiprocessing by editing your .boto config or by adding the following flag to your command: `-o "GSUtil:parallel_process_count=1"`.
Note that multithreading is still available even if you disable multiprocessing.
```

## ç’°å¢ƒ

```bash
$ sw_vers
ProductName:    Mac OS X
ProductVersion: 10.15.7
BuildVersion:   19H114

$ gcloud version
Google Cloud SDK 321.0.0
bq 2.0.64
core 2020.12.11
gsutil 4.57

$ gsutil version -l
gsutil version: 4.57
boto version: 2.49.0
python version: 3.6.5 |Anaconda, Inc.| (default, Apr 26 2018, 08:42:37) [GCC 4.2.1 Compatible Clang 4.0.1 (tags/RELEASE_401/final)]
OS: Darwin 19.6.0
multiprocessing available: True
using cloud sdk: True
pass cloud sdk credentials to gsutil: True
```

## è§£æ±ºæ–¹æ³•

`gsutil cp -r gs://firebase-tutorial-suzuki.appspot.com/buckup-test .` ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ããŸã€‚

â€» commandã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã¦ã­ã¨æ›¸ã„ã¦ã‚ã£ãŸã®ã§ã€ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸãŒã“ã‚Œã§ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚
`gsutil -o "GSUtil:parallel_process_count=1" -m cp -r "gs://firebase-tutorial-suzuki.appspot.com/buckup-test/" .`

## çµ‚ã‚ã‚Š

`-m` ã¯ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹optionã®ã‚ˆã†ã§ã™ãŒã‚¨ãƒ©ãƒ¼ã«ãªã‚‹æ ¹æœ¬ã®ç†ç”±ã¾ã§ã¯èª¿ã¹ãã‚Œã¦ã„ã¾ã›ã‚“ã€‚

https://cloud.google.com/storage/docs/gsutil/addlhelp/TopLevelCommandLineOptions?hl=ja