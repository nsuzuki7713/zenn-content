---
title: "Cloud Loggingã®ã‚¯ã‚¨ãƒªè¨€èªžã‚’ã¾ã¨ã‚ã¦ã„ã"
emoji: "ðŸ‘¨â€ðŸ”¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [GCP, CloudLogging]
published: true
---


## ã¯ã˜ã‚ã«

Cloud Loggingã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã‚¯ã‚¨ãƒªã®æ›¸ãæ–¹ãŒåˆ†ã‹ã‚‰ãšè‹¦æˆ¦ã—ãŸã®ã§å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿ãªãŒã‚‰ç¢ºèªã—ãŸå†…å®¹ã‚’æ›¸ã„ã¦ã„ã¾ã™ã€‚

## ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰ãƒ­ã‚°ã‚’é€ä¿¡

ã“ã¡ã‚‰ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¼‰ã£ã¦ã„ã„ã¾ã™ã€‚
ä»Šå›žã¯ã€nodeã®winstonã‚’ä½¿ã£ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ã¾ã—ãŸã€‚

https://cloud.google.com/logging/docs/setup/nodejs?hl=ja


```ts:index.ts
// Imports the Google Cloud client library for Winston
import { LoggingWinston } from '@google-cloud/logging-winston';
import winston from 'winston';

// Creates a client
const loggingWinston = new LoggingWinston({
  projectId: 'your-project-id',
  keyFilename: '/path/to/key.json',
});

// Create a Winston logger that streams to Stackdriver Logging
// Logs will be written to: "projects/YOUR_PROJECT_ID/logs/winston_log"
const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.Console(),
    // Add Stackdriver Logging
    loggingWinston,
  ],
});

logger.info('info message', {
  name: 'éˆ´æœ¨ãŸã‚ã†',
  age: '34',
  like: ['ãƒ©ãƒ¼ãƒ¡ãƒ³', 'å°†æ£‹', 'ç¡çœ '],
  attribute: { phone: '000', birth: '2000' },
});
```

å®Ÿè¡Œã™ã‚‹ã¨ã“ã®ã‚ˆã†ãªå½¢ã§ãƒ­ã‚°ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚
ã‚¯ã‚¨ãƒªã®å‹•ä½œç¢ºèªã—ãŸéš›ã¯ã“ã‚Œã§ãƒ‡ãƒ¼ã‚¿ãŒä½œã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/96xa4l0ci0fu8axdwzwc5gz7hhxd)

## Logging ã®ã‚¯ã‚¨ãƒªè¨€èªž

ã“ã¡ã‚‰ã‚‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè©³ã—ãæ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚
https://cloud.google.com/logging/docs/view/logging-query-language?hl=ja

### ãƒ–ãƒ¼ãƒ«æ¼”ç®—å­

`AND`, `OR`, `NOT` ãŒä½¿ç”¨ã§ãã¾ã™ã€‚(æ¼”ç®—å­ã¯å¸¸ã«å¤§æ–‡å­—ã®å¿…è¦ãŒã‚ã‚Š)

ä¾‹ãˆã°ã“ã®ã‚ˆã†ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚
```
(jsonPayload.metadata.name = "éˆ´æœ¨ãŸã‚ã†" AND jsonPayload.metadata.age =34) 
OR jsonPayload.metadata.age =21 
NOT jsonPayload.metadata.name = "éˆ´æœ¨ä¸‰éƒŽ"
```

æ¯”è¼ƒã®æ¼”ç®—å­`AND`ã¯çœç•¥ã§ãã€ã¾ãŸã€`NOT`ã¯`-`ã§æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

ä¸‹è¨˜ã®ã‚¯ã‚¨ãƒªã¯ä¸Šè¨˜ã¨ã‚‚ã®ã¨åŒã˜ã§ã™ã€‚

```
(jsonPayload.metadata.name = "éˆ´æœ¨ãŸã‚ã†" jsonPayload.metadata.age =34)
OR jsonPayload.metadata.age =21 
-jsonPayload.metadata.name = "éˆ´æœ¨ä¸‰éƒŽ"
```

ã¾ãŸã€å€¤ã‚’ã¾ã¨ã‚ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
`jsonPayload.metadata.name = ("éˆ´æœ¨ãŸã‚ã†" OR "éˆ´æœ¨æ¬¡éƒŽ")` ã¯åˆ†é…ã•ã‚Œã¦ä¸‹è¨˜ã¨åŒã˜æ„å‘³ã§ã™ã€‚
`jsonPayload.metadata.name = "éˆ´æœ¨ãŸã‚ã†" OR jsonPayload.metadata.name = "éˆ´æœ¨æ¬¡éƒŽ"`

### æ¯”è¼ƒæ¼”ç®—å­

`=`, `!=`, `>`, `<`, `>=`, `<=`, `:`, `=~`, `!~` ãŒã§ã™ã€‚
ä¸€éƒ¨ã€ç‰¹æ®Šãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ãŒã€ä¸€èˆ¬çš„ãªæ¼”ç®—å­ã§ã™ã€‚

`:` ã°éƒ¨åˆ†ä¸€è‡´ã®æ¼”ç®—å­ã§ã™ã€‚
`jsonPayload.metadata.name : "éˆ´æœ¨"` ã¯`éˆ´æœ¨`ã¨ã„ã†æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã‚‹ã‚‚ã®ãŒæŠ½å‡ºã§ãã¾ã™ã€‚

`=~`ã¨`!~`ã¯æ­£è¦è¡¨ç¾ã‚’è¡¨ã™æ¼”ç®—å­ã§ã™ã€‚
`jsonPayload.metadata.name =~ "^éˆ´æœ¨$"` ã®ã‚ˆã†ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã€æ­£è¦è¡¨ç¾ã«ä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’æŠ½å‡ºã§ãã¾ã™ã€‚
`!~`ã¯åå¯¾ã«ä¸€è‡´ã—ãªã„ã‚‚ã®ã‚’æŠ½å‡ºã§ãã¾ã™ã€‚


### ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨é…åˆ—ã®åž‹

æ—¢ã«ä¾‹ç¤ºã§ä¸Šã’ã¦ã„ã‚‹ã‚ˆã†ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯`.`ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

ã¾ãŸã€é…åˆ—ã®å ´åˆã¯é…åˆ—å†…ã«ï¼‘ã¤ã§ã‚‚ä¸€è‡´ã™ã‚‹å ´åˆã€æŠ½å‡ºã•ã‚Œã¾ã™ã€‚

ä¾‹ãˆã°ã“ã†ã„ã†ãƒ­ã‚°ãŒã‚ã‚‹å ´åˆ
```
{
  name: 'éˆ´æœ¨ãŸã‚ã†',
  age: '34',
  like: ['ãƒ©ãƒ¼ãƒ¡ãƒ³', 'å°†æ£‹', 'ç¡çœ '],
  attribute: { phone: '000', birth: '2000' },
}
```

`jsonPayload.like = "ãƒ©ãƒ¼ãƒ¡ãƒ³"` ã®ã‚¯ã‚¨ãƒªã‚’ã™ã‚‹ã¨æŠ½å‡ºã•ã‚Œã¾ã™ã€‚

## ãŠã‚ã‚Šã«

ã“ã‚Œä»¥å¤–ã«ã‚‚ä¾¿åˆ©ãªé–¢æ•°ã¨ã‹ã‚ã‚‹ã®ã§å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ã„ãŸã ã‘ã‚Œã°ã§ã™ã€‚

ãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ã¯çµæ§‹å„ªç§€ãªã®ã§ã€ã½ã¡ã½ã¡ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã ã‘ã§ã‚‚ãƒ­ã‚°ã‚’çµžã‚Šè¾¼ã‚€ã“ã¨ã¯ã§ãã¾ã™ã€‚
ãŸã ã€æ§‹é€ åŒ–ã•ã‚ŒãŸå€¤ã®ä¸­èº«ã§æ¤œç´¢ã—ãŸã„å ´åˆã¯ã‚¯ã‚¨ãƒªã‚’æ›¸ãå¿…è¦ãŒã‚ã‚‹ã®ã§ã€ã‚¯ã‚¨ãƒªè¨€èªžã¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æŠŠæ¡ã—ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»Šå›žã¯è¶…æœ€ä½Žé™ã®ã“ã¨ã—ã‹æ›¸ã„ã¦ã„ãªã„ã®ã§ã€ã¡ã‚‡ã£ã¨ãšã¤è¿½è¨˜ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚
