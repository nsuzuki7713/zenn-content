---
title: "firebase-functions ã‚’ä½¿ã£ã¦ Cloud Functions forã€€Firebase v2ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ãŸã€‚"
emoji: "ğŸ‘‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["CloudFunctions", "Firebase"]
published: true
---

# æ¦‚è¦

Cloud Functions (2nd gen)ã€€ãŒ[GA](https://cloud.google.com/release-notes#August_03_2022)ã«ãªã£ã¦ã„ãŸã®ã§ã€firebase-functions ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã—ãŸã€‚

â€»Cloud Functions for Firebase v2 ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã™ã€‚
https://firebase.google.com/docs/functions/beta?hl=en

# å‰æ
```
firebase-tools: 11.4.2
firebase-functions: 3.22.0
```

# ã‚³ãƒ¼ãƒ‰

https://firebase.google.com/docs/functions/typescript?hl=ja ã‚’åŸºã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
`index.ts` ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«å¤‰æ›´ã€‚ã“ã¡ã‚‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’[å‚è€ƒ](https://firebase.google.com/docs/functions/beta/get-started)ã«ã—ã¦ã„ã¾ã™ã€‚

`v1` ã¨ `v2` ã§ region ã‚„ runtimeOptions ã®è¨­å®šæ–¹æ³•ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã¾ã™ã€‚

```typescript:index.ts
import * as functions from 'firebase-functions';
import * as functionsV1 from 'firebase-functions/v1';
import * as functionsV2 from 'firebase-functions/v2';

// `firebase-functions` ã‹ã‚‰ import ã—ãŸã®ã¯ v1 ã§ä½œæˆã•ã‚Œã‚‹ã€‚
export const helloWorld = functions
  .region('asia-northeast1')
  .runWith({ memory: '512MB' })
  .https.onRequest((request, response) => {
    functions.logger.info('Hello logs!', { structuredData: true });
    response.send('Hello from Firebase!');
  });

// `firebase-functions/v1` ã‹ã‚‰ import ã—ãŸã®ã¯ v1 ã§ä½œæˆã•ã‚Œã‚‹ã€‚
export const helloWorldV1 = functionsV1
  .region('asia-northeast1')
  .runWith({ memory: '512MB' })
  .https.onRequest((request, response) => {
    functionsV1.logger.info('Hello logs V1!', { structuredData: true });
    response.send('Hello from Firebase V1!');
  });

// `firebase-functions/v2` ã‹ã‚‰ import ã—ãŸã®ã¯ v2 ã§ä½œæˆã•ã‚Œã‚‹ã€‚
// functionåã®ãƒ«ãƒ¼ãƒ«ãŒV2ã¨V1ã§å¤‰æ›´ã«ãªã£ã¦ã„ã‚‹ã€‚å¤§æ–‡å­—ã¯ä½¿ãˆãªããªã£ãŸã€‚
// https://github.com/firebase/firebase-tools/blob/5ea735ec96eec1eb4d016ea447e092dadbec7481/src/deploy/functions/validate.ts#L147
export const helloworldv2 = functionsV2.https.onRequest(
  { region: 'asia-northeast1', memory: '512MiB' },
  (request, response) => {
    functionsV2.logger.info('Hello logs!', { structuredData: true });
    response.send('Hello from Firebase V2!');
  }
);
```

`firebase deploy` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãª URL ã§ä½œæˆã•ã‚Œã‚‹ã€‚
`v2` ã¯ `https://{func-revision}.a.run.app` ã® URL ã«ãªã‚Šã¾ã™ã€‚


```
Function URL (helloWorld(asia-northeast1)): https://asia-northeast1-cloudfuncions-sample-project.cloudfunctions.net/helloWorld
Function URL (helloWorldV1(asia-northeast1)): https://asia-northeast1-cloudfuncions-sample-project.cloudfunctions.net/helloWorldV1
Function URL (helloworldv2(asia-northeast1)): https://helloworldv2-qo2ofg2sqa-an.a.run.app
```

**CloudFunctionã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢**
![](https://storage.googleapis.com/zenn-user-upload/4b5a711e768b-20220806.png)

**CloudRunã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢**
v2 ã¯ CloudRun ä¸Šã§æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã“ã¡ã‚‰ã«ã‚‚ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/b6b12fedc006-20220806.png)

# å‚è€ƒURL
https://qiita.com/gzock/items/4ae721fad4ed09b3ba86




